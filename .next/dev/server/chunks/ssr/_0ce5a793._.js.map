{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/saikrishna/misc/OpenScribe/app/actions.ts"],"sourcesContent":["\"use server\"\n\nimport { generateText } from \"ai\"\nimport { createOpenAI } from \"@ai-sdk/openai\"\nimport { SYSTEM_PROMPT, generateUserPrompt } from \"@/app/utils/prompts\"\n\nexport async function transcribeAudio(audioBlob: Blob, apiKey: string | null): Promise<string> {\n  try {\n    // Check if we have a Whisper API URL configured (for Docker setup)\n    const whisperUrl = process.env.WHISPER_API_URL\n    \n    if(!whisperUrl) {\n      throw new Error(\"Whisper API URL is not configured\")\n    }\n\n    const response = await fetch(`${whisperUrl}/v1/audio/transcriptions`, {\n      method: \"POST\",\n      body: audioBlob,\n    })\n\n    if (!response.ok) {\n      const errorText = await response.text()\n      console.error(\"Whisper API error:\", errorText)\n      throw new Error(`Whisper API failed: ${response.status} ${errorText}`)\n    }\n\n    const data = await response.json()\n    return data.text\n\n  } catch (error) {\n    console.error(\"Transcription error:\", error)\n    throw new Error(\"Failed to transcribe audio\")\n  }\n}\n\nexport async function generateClinicalNote(params: {\n  transcript: string\n  patient_name: string\n  visit_reason: string\n  apiKey: string | null\n}): Promise<string> {\n  const { transcript, patient_name, visit_reason, apiKey } = params\n\n  const systemPrompt = `You are a clinical documentation assistant that converts patient encounter transcripts into structured clinical notes.\n\nIMPORTANT INSTRUCTIONS:\n- Output ONLY plain text in the exact format shown below\n- Do NOT use JSON, markdown code blocks, or any special formatting\n- Use ONLY information explicitly stated in the transcript\n- If a section has no relevant information, write \"Not discussed\"\n- Use professional medical terminology while keeping notes concise\n- This is a DRAFT that requires clinician review\n\nOUTPUT FORMAT (follow exactly):\n\nChief Complaint:\n[Primary reason for visit in 1-2 sentences]\n\nHPI:\n[History of present illness - onset, duration, character, severity, modifying factors]\n\nROS:\n[Review of systems - symptoms mentioned, organized by system]\n\nPhysical Exam:\n[Any exam findings mentioned, or \"Not documented\" if none]\n\nAssessment:\n[Clinical assessment/diagnosis mentioned by clinician]\n\nPlan:\n[Treatment plan discussed with patient]`\n\n  const userPrompt = `Convert this clinical encounter into a structured note.\n\nPatient Name: ${patient_name || \"Not provided\"}\nVisit Reason: ${visit_reason || \"Not provided\"}\n\nTRANSCRIPT:\n${transcript}\n\nGenerate the clinical note now, following the exact format specified.`\n\n  try {\n    if (apiKey) {\n      const openai = createOpenAI({ apiKey })\n      const { text } = await generateText({\n        model: openai(\"gpt-4o\"),\n        system: systemPrompt,\n        prompt: userPrompt,\n      })\n      return text\n    } else {\n      // Fallback to AI Gateway (no API key needed)\n      const { text } = await generateText({\n        model: \"openai/gpt-4o\",\n        system: systemPrompt,\n        prompt: userPrompt,\n      })\n      return text\n    }\n  } catch (error) {\n    console.error(\"AI generation error:\", error)\n    throw new Error(`Failed to generate note: ${error instanceof Error ? error.message : \"Unknown error\"}`)\n  }\n}\n"],"names":[],"mappings":";;;;;;;AAEA;AACA;;;;;AAGO,eAAe,gBAAgB,SAAe,EAAE,MAAqB;IAC1E,IAAI;QACF,mEAAmE;QACnE,MAAM,aAAa,QAAQ,GAAG,CAAC,eAAe;QAE9C,IAAG,CAAC,YAAY;YACd,MAAM,IAAI,MAAM;QAClB;QAEA,MAAM,WAAW,MAAM,MAAM,GAAG,WAAW,wBAAwB,CAAC,EAAE;YACpE,QAAQ;YACR,MAAM;QACR;QAEA,IAAI,CAAC,SAAS,EAAE,EAAE;YAChB,MAAM,YAAY,MAAM,SAAS,IAAI;YACrC,QAAQ,KAAK,CAAC,sBAAsB;YACpC,MAAM,IAAI,MAAM,CAAC,oBAAoB,EAAE,SAAS,MAAM,CAAC,CAAC,EAAE,WAAW;QACvE;QAEA,MAAM,OAAO,MAAM,SAAS,IAAI;QAChC,OAAO,KAAK,IAAI;IAElB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,wBAAwB;QACtC,MAAM,IAAI,MAAM;IAClB;AACF;AAEO,eAAe,qBAAqB,MAK1C;IACC,MAAM,EAAE,UAAU,EAAE,YAAY,EAAE,YAAY,EAAE,MAAM,EAAE,GAAG;IAE3D,MAAM,eAAe,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;uCA4Be,CAAC;IAEtC,MAAM,aAAa,CAAC;;cAER,EAAE,gBAAgB,eAAe;cACjC,EAAE,gBAAgB,eAAe;;;AAG/C,EAAE,WAAW;;qEAEwD,CAAC;IAEpE,IAAI;QACF,IAAI,QAAQ;YACV,MAAM,SAAS,IAAA,+PAAY,EAAC;gBAAE;YAAO;YACrC,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,IAAA,0OAAY,EAAC;gBAClC,OAAO,OAAO;gBACd,QAAQ;gBACR,QAAQ;YACV;YACA,OAAO;QACT,OAAO;YACL,6CAA6C;YAC7C,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,IAAA,0OAAY,EAAC;gBAClC,OAAO;gBACP,QAAQ;gBACR,QAAQ;YACV;YACA,OAAO;QACT;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,wBAAwB;QACtC,MAAM,IAAI,MAAM,CAAC,yBAAyB,EAAE,iBAAiB,QAAQ,MAAM,OAAO,GAAG,iBAAiB;IACxG;AACF;;;IAnGsB;IA6BA;;AA7BA,sZAAA;AA6BA,sZAAA"}},
    {"offset": {"line": 116, "column": 0}, "map": {"version":3,"sources":["file:///Users/saikrishna/misc/OpenScribe/.next-internal/server/app/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {transcribeAudio as '60131ca343eff8da86fa092aac608eadb8489c6878'} from 'ACTIONS_MODULE0'\nexport {generateClinicalNote as '40b2687437ea74cc4409f66ee4a755835b9c89eea3'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA"}}]
}